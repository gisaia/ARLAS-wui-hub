<form [formGroup]="collectionForm" autocomplete="off">
    <div class="collection" *ngIf="!!collection">
        <div class="collection__back">
            <button class="collection__back__btn" mat-stroked-button (click)="back()">Â« Collections</button>
            <button class="collection__back__update" [class.spinner]="isLoading" [disabled]="isLoading" mat-flat-button color="primary" (click)="update()">Update</button>
        </div>
        <div class="collection__title">
            <div class="collection__title__content">
                <span class="collection__title__content__display-name">
                    <mat-form-field class="small" floatLabel="never" appearance="outline">
                        <input matInput class="input-display-name"
                            formControlName="collection_display_name">
                    </mat-form-field>
                </span>
                <span class="collection__title__content__name">({{collection.collection_name}})</span>
            </div>
        </div>
        <div class="collection__info">
            <div class="collection__info__visibility">
                <div class="collection__info__visibility__title">
                    {{'Visibility' | translate}}
                </div>
                <div class="collection__info__visibility__items">
                    <div class="collection__info__visibility__items__item">
                        <span class="prop">{{'Owner' | translate}}</span>
                        <span class="value">{{collection.params.organisations.owner}}</span>
                    </div>
                    <div class="collection__info__visibility__items__item">
                        <span class="prop">{{'Shared with' | translate}}</span>
                        <span class="value">{{collection.params.organisations.shared}}</span>
                    </div>
                    <div class="collection__info__visibility__items__item">
                        <span class="prop">{{'is Public' | translate}}</span>
                        <span class="value">{{$any(collection.params.organisations).public}}</span>
                    </div>
                </div>
            </div>
            <div class="collection__info__params">
                <div class="collection__info__params__title">
                    {{'Parameters' | translate}}
                </div>
                <div class="collection__info__params__items">
                    <div class="collection__info__params__items__item">
                        <span class="prop">{{'id' | translate}}</span>
                        <span class="value">{{collection.params.id_path}}</span>
                    </div>
                    <div class="collection__info__params__items__item">
                        <span class="prop">{{'Centroid' | translate}}</span>
                        <span class="value">{{collection.params.centroid_path}}</span>
                    </div>
                    <div class="collection__info__params__items__item">
                        <span class="prop">{{'Geometry' | translate}}</span>
                        <span class="value">{{collection.params.geometry_path}}</span>
                    </div>
                    <div class="collection__info__params__items__item">
                        <span class="prop">{{'Timestamp' | translate}}</span>
                        <span class="value">{{collection.params.timestamp_path}}</span>
                    </div>
                    <div class="collection__info__params__items__item">
                        <span class="prop">{{'Index name' | translate}}</span>
                        <span class="value">{{collection.params.index_name}}</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="collection__fields">
            <!-- <code>{{fieldsForm.value | json}}</code> -->

            <div class="collection__fields__title">{{'Fields' | translate}}</div>
            <div class="collection__fields__table">

                <ng-container formArrayName="display_names">
                    <table mat-table [dataSource]="displayNames.controls">
                        <ng-container matColumnDef="name">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> {{'Name' | translate}} </th>
                            <td mat-cell *matCellDef="let row">
                                {{row.get('name').value}}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="display_name">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> {{'Display name' | translate}} </th>
                            <td mat-cell *matCellDef="let row" [formGroup]="row">
                                @if (row.get('type').value !== 'OBJECT') {
                                <mat-form-field class="small" floatLabel="never" appearance="outline">
                                    <input matInput class="input-display-name" placeholder="..."
                                        formControlName="display_name">
                                </mat-form-field>
                                }
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="type">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> {{'Type' | translate}} </th>
                            <td mat-cell *matCellDef="let row">
                                {{row.get('type').value}}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="taggable">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> {{'Taggable' | translate}} </th>
                            <td mat-cell *matCellDef="let row">
                                {{row.get('taggable').value}}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="indexed">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> {{'Indexed' | translate}} </th>
                            <td mat-cell *matCellDef="let row">
                                {{row.get('indexed').value}}
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                    </table>
                </ng-container>

            </div>
        </div>
    </div>
</form>
